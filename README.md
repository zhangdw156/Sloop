# Sloop

**Sloop** æ˜¯ä¸€ä¸ªåŸºäºä¸‹æ¨è‡ªåŠ¨æœº (Pushdown Automaton, PDA) çš„å¤šè½®å·¥å…·è°ƒç”¨ (Tool-Use) æ•°æ®ç”Ÿæˆæ¡†æ¶ã€‚å®ƒé€šè¿‡æ¨¡æ‹Ÿ Userã€Assistant å’Œ Service ä¸‰æ–¹çš„äº¤äº’ï¼Œè‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡ã€é€»è¾‘ä¸¥å¯†çš„å¯¹è¯æ•°æ®ï¼Œç”¨äºè®­ç»ƒå’Œè¯„ä¼°å¤§è¯­è¨€æ¨¡å‹çš„å·¥å…·è°ƒç”¨èƒ½åŠ›ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- **PDA é©±åŠ¨å¼•æ“**: æ‘’å¼ƒä¼ ç»Ÿçš„æœ‰é™çŠ¶æ€æœº (FSM)ï¼Œé‡‡ç”¨ä¸‹æ¨è‡ªåŠ¨æœº (PDA) ç®¡ç†å¯¹è¯çŠ¶æ€ã€‚åˆ©ç”¨æ ˆç»“æ„å¤„ç†åµŒå¥—çš„å·¥å…·è°ƒç”¨å’Œå¤æ‚çš„å¯¹è¯æµè½¬ï¼ŒçŠ¶æ€ç®¡ç†æ›´åŠ çµæ´»å¼ºå¤§ã€‚
- **å¤šæ™ºèƒ½ä½“æ¨¡æ‹Ÿ (Multi-Agent Simulation)**:
  - **User Agent**: åŸºäºæ„å›¾ (Intent) å’Œè“å›¾ (Blueprint) æ¨¡æ‹Ÿç”¨æˆ·è¡Œä¸ºã€‚
  - **Assistant Agent**: æ¨¡æ‹Ÿè¢«æµ‹æ¨¡å‹ï¼Œæ‰§è¡Œæ€è€ƒ (Think)ã€å†³ç­– (Decide) å’Œå·¥å…·è°ƒç”¨ (Tool Call)ã€‚
  - **Service Agent**: æ¨¡æ‹ŸçœŸå® API æœåŠ¡ï¼Œç»´æŠ¤ç¯å¢ƒçŠ¶æ€ (Environment State)ï¼Œè¿”å›æ‰§è¡Œç»“æœã€‚
- **æ™ºèƒ½è“å›¾ç”Ÿæˆ (Blueprint Generation)**: ç»“åˆå·¥å…·å›¾è°± (Tool Graph) åˆ†æå’Œ LLM çš„æƒ³è±¡åŠ›ï¼Œè‡ªåŠ¨ç”Ÿæˆåˆç†çš„å¯¹è¯æ„å›¾å’Œä»»åŠ¡è“å›¾ã€‚
- **RAG å¢å¼ºé‡‡æ · (RAG Sampling)**: åˆ©ç”¨å‘é‡æ£€ç´¢å’Œ LLM è£åˆ¤æ¥ç”Ÿæˆé€»è¾‘æ›´è¿è´¯çš„å¤šè½®å¯¹è¯ï¼Œæå‡æ•°æ®è´¨é‡å’Œå¤šæ ·æ€§ã€‚
- **å·¥å…·å›¾è°±æ„å»º**: ä½¿ç”¨ NetworkX æ„å»ºå‚æ•°çº§çš„å·¥å…·ä¾èµ–å›¾ï¼Œç¡®ä¿ç”Ÿæˆçš„å·¥å…·è°ƒç”¨åºåˆ—ç¬¦åˆé€»è¾‘ä¾èµ–ã€‚
- **å…¨å¼‚æ­¥/æµå¼æ”¯æŒ**: æ ¸å¿ƒç»„ä»¶è®¾è®¡æ”¯æŒå¼‚æ­¥æ“ä½œï¼ˆå…·ä½“å®ç°è§† LLM å®¢æˆ·ç«¯è€Œå®šï¼‰ã€‚

## ğŸ› ï¸ å®‰è£…æŒ‡å—

æœ¬é¡¹ç›®æ¨èä½¿ç”¨ [uv](https://github.com/astral-sh/uv) è¿›è¡Œä¾èµ–ç®¡ç†å’Œç¯å¢ƒé…ç½®ã€‚

### å‰ç½®è¦æ±‚

- Python >= 3.12
- uv (å¯é€‰ï¼Œä½†æ¨è)

### ä½¿ç”¨ uv å®‰è£… (æ¨è)

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-org/Sloop.git
cd Sloop

# åŒæ­¥ä¾èµ–ç¯å¢ƒ
uv sync

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source .venv/bin/activate
```

### ä½¿ç”¨ pip å®‰è£…

```bash
pip install .
```

*(æ³¨ï¼šç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç† `faiss-cpu` å’Œ `numpy` ç­‰å‘é‡æ£€ç´¢ç›¸å…³ä¾èµ–)*

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¤ºä¾‹é…ç½®æ–‡ä»¶å¹¶å¡«å…¥ä½ çš„ LLM API å¯†é’¥ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```ini
OPENAI_API_KEY=your_api_key_here
MODEL_NAME=gpt-4o-mini  # æˆ–å…¶ä»–å…¼å®¹ OpenAI æ¥å£çš„æ¨¡å‹
# OPENAI_API_BASE=...   # å¦‚æœä½¿ç”¨è‡ªå®šä¹‰ç«¯ç‚¹
```

### 2. è¿è¡Œç”Ÿæˆå‘½ä»¤

ä½¿ç”¨ `sloop` å‘½ä»¤è¡Œå·¥å…·ç”Ÿæˆæ•°æ®ï¼š

```bash
# æŸ¥çœ‹å¸®åŠ©
sloop --help

# é»˜è®¤æ¨¡å¼ (å›¾è°±éšæœºæ¸¸èµ°)
sloop generate --mode graph

# æ–°æ¨¡å¼ (RAG å¢å¼ºé‡‡æ ·)
sloop generate --mode rag
```

*(æ³¨ï¼šå½“å‰ CLI å…¥å£ä½äº `sloop/cli/main.py`ï¼Œå…·ä½“å‘½ä»¤å‚æ•°è¯·ä»¥å®é™…å¸®åŠ©ä¿¡æ¯ä¸ºå‡†)*

## ğŸ“‚ é¡¹ç›®ç»“æ„

```text
sloop/
â”œâ”€â”€ agents/             # æ™ºèƒ½ä½“æ¨¡æ‹Ÿå™¨
â”‚   â”œâ”€â”€ user.py         # ç”¨æˆ·æ¨¡æ‹Ÿ
â”‚   â”œâ”€â”€ assistant.py    # åŠ©æ‰‹æ¨¡æ‹Ÿ
â”‚   â””â”€â”€ service.py      # æœåŠ¡/ç¯å¢ƒæ¨¡æ‹Ÿ
â”œâ”€â”€ engine/             # æ ¸å¿ƒå¼•æ“
â”‚   â”œâ”€â”€ pda.py          # ä¸‹æ¨è‡ªåŠ¨æœº (PDA) å®ç°
â”‚   â”œâ”€â”€ blueprint.py    # è“å›¾ç”Ÿæˆå™¨
â”‚   â””â”€â”€ graph.py        # å·¥å…·å›¾è°±æ„å»º
â”œâ”€â”€ models/             # æ•°æ®æ¨¡å‹ (Pydantic)
â”‚   â”œâ”€â”€ schema.py       # åŸºç¡€æ•°æ®ç»“æ„
â”‚   â”œâ”€â”€ state.py        # çŠ¶æ€ç®¡ç†
â”‚   â””â”€â”€ blueprint.py    # è“å›¾å®šä¹‰
â”œâ”€â”€ utils/              # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ llm.py          # LLM è°ƒç”¨å°è£…
â”‚   â””â”€â”€ template.py     # Prompt æ¨¡æ¿
â”œâ”€â”€ templates/          # Jinja2 æ¨¡æ¿æ–‡ä»¶
â””â”€â”€ cli/                # å‘½ä»¤è¡Œæ¥å£
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Pull Request æˆ– Issueï¼åœ¨æäº¤ä»£ç å‰ï¼Œè¯·ç¡®ä¿é€šè¿‡äº† lint æ£€æŸ¥ï¼š

```bash
uv run ruff check .
```

## ğŸ“„ è®¸å¯è¯

[License Name]
